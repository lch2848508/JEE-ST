<?xml version="1.0" encoding="utf-8"?>
<s:NavigatorContent icon="@Embed(source='/assets/common/forms.png')" xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark" xmlns:mx="library://ns.adobe.com/flex/mx" width="100%" height="100%" creationPolicy="all" xmlns:component="com.estudio.flex.component.*">
    <s:layout>
        <s:VerticalLayout gap="0"/>
    </s:layout>

    <fx:Script>
        <![CDATA[
            import com.estudio.flex.RUNTIME_COMMAND;
            import com.estudio.flex.common.InterfaceFormUI;
            import com.estudio.flex.common.InterfaceWorkFlowUI;
            import com.estudio.flex.component.mx.FormLinkBar;

            import mx.core.UIComponent;
            import mx.events.ItemClickEvent;
            private var formUI:InterfaceFormUI = null;
            private var formid2linkbar:Object = {};
            private var workflowUI:InterfaceWorkFlowUI = null;
            private var workflowUIID2Toolbar:Object = {};
            //-------------------------------------------------------------------------------------------

            [Embed(source = "assets/common/save.png")] //退回
            [Bindable]
            public var imgSave:Class;

            [Embed(source = "assets/common/back.png")] //退回
            [Bindable]
            public var imgBack:Class;

            [Embed(source = "assets/common/go.png")] //发送
            [Bindable]
            public var imgGo:Class;

            [Embed(source = "assets/common/sitemap.png")] //流程图
            [Bindable]
            public var imgWorkFlow:Class;

            [Embed(source = "assets/common/idea.png")] //审批意见
            [Bindable]
            public var imgIdea:Class;



            public function addForm(workflowUIInstance:InterfaceWorkFlowUI , module:UIComponent , formUI:InterfaceFormUI):void
            {
                formContain.removeAllElements ();
                workflowUI = workflowUIInstance;
                this.formUI = formUI;
                formContain.addElement (module);
                createFormLinkBar ();
                createFormToolbar ();
            }

            private function createFormLinkBar():void
            {
                if (formUI.getFormCaptions ().length == 0)
                    callLater (createFormLinkBar);
                else
                {
                    var formLinkBar:FormLinkBar = formid2linkbar[formUI.getIFrameID ()];
                    if (!formLinkBar)
                    {
                        formLinkBar = new FormLinkBar ();
                        formLinkBar.createLinkBars (formUI.getFormCaptions ().source , formLinkbarCallbackFunction);
                        formid2linkbar[formUI.getIFrameID ()] = formLinkBar;
                    }
                    formLinkBarContain.removeAllElements ();
                    formLinkBarContain.addElement (formLinkBar);
                    formLinkBar.selectFirst ();
                }
            }

            private function formLinkbarCallbackFunction(index:int):void
            {
                formUI.selectForm (index);
            }

            private function createFormToolbar():void
            {
                var toolbarItems:Array = workflowUIID2Toolbar[workflowUI.ui_id];
                if (!toolbarItems)
                {
                    toolbarItems = [];
                    workflowUIID2Toolbar[workflowUI.ui_id] = workflowUIID2Toolbar[workflowUI.ui_id];
                    var options:Object = workflowUI.getUIOptions ();
                    if (!options.isDataReadOnly)
                        toolbarItems.push ({label: "保存" , icon: imgSave , index: 0 , hint: "保存数据"});
                    if (options.isSendAble && !options.isDataReadOnly)
                        toolbarItems.push ({label: "保存后发送" , index: 1 , hint: "保存表单并将业务发送到下一环节" , icon: imgGo , tag: RUNTIME_COMMAND.COMMAND_WORKFLOW_SEND_CASE});
                    if (options.isBackAble && !options.isDataReadOnly)
                        toolbarItems.push ({label: "退回" , index: 2 , hint: "将业务退回给发件人" , icon: imgBack , tag: RUNTIME_COMMAND.COMMAND_WORKFLOW_BACK_CASE}); //退回业务
                    if (options.isIdeaAble)
                        toolbarItems.push ({label: "流程图" , index: 3 , hint: "查看业务流程图" , icon: imgWorkFlow , tag: RUNTIME_COMMAND.COMMAND_WORKFLOW_VIEW_DIAGRAM});
                }
                formToolbar.dataProvider = toolbarItems;
            }

            protected function formToolbar_itemClickHandler(event:ItemClickEvent):void
            {
                var object:Object = event.item;
                switch (object.index)
                {
                    case 0:
                        formUI.saveEx (false);
                        break;
                    case 1:
                        formUI.saveEx (false);
                        workflowUI["workFunction4Href"] (object.tag);
                        break;
                    case 2:
                        workflowUI["workFunction4Href"] (object.tag);
                        break;
                    case 3:
                        workflowUI["workFunction4Href"] (object.tag);
                        break;
                }
            }
        ]]>
    </fx:Script>
    <s:BorderContainer width="100%" height="28" backgroundColor="0xDCEBFE" borderVisible="false">
        <s:layout>
            <s:HorizontalLayout gap="0"/>
        </s:layout>
        <s:HGroup width="100%" height="100%" id="formLinkBarContain" verticalAlign="middle"/>
        <!-- 表单页面切换 -->
        <mx:LinkBar id="formToolbar" itemClick="formToolbar_itemClickHandler(event)" toolTipField="hint" paddingLeft="0" paddingRight="0" paddingTop="0" paddingBottom="0" height="100%" backgroundColor="0xDCEBFE" contentBackgroundAlpha=".1">
        </mx:LinkBar>
        <!-- 工具条 -->
    </s:BorderContainer>

    <s:Group id="formContain" width="100%" height="100%">

    </s:Group>

</s:NavigatorContent>
